var KomeiInput=function(){"use strict";function t(t,e){this.el=t,this.options=e}function e(e,i){return t.normalizeQuery(e)===t.normalizeQuery(i)}return t.normalizeQuery=function(t){return t.replace(/^\s*/g,"").replace(/\s{2,}/g," ")},_.mixin(t.prototype,{_initialize:function(){this.query="",this.bind(),this._onInput()},_onInput:function(){this._setQuery(this.getInputValue())},_setQuery:function(t,i){var n,s;t.length<this.options.minLength||(n=e(t,this.query),s=n?this.query.length!==t.length:!1,this.query=t,n?s&&this.emit("whitespaceChanged",this.query):this.emit("queryChanged",this.query))},initialize:function(){this._initialize()},getInputValue:function(){return this.el.value},setInputValue:function(t){this.el.value=t},resetInputValue:function(){this.setInputValue(this.query)},emit:function(t,e){var i=new CustomEvent(t,{detail:e});this.el.dispatchEvent(i)},bind:function(){var t=this;t.el.onkeyup=function(e){e||(e=window.event);var i=e.keyCode||e.which;"onType"===t.options.mode?t._onInput():"13"==i&&t._onInput()}}}),t}(),KomeiSearchResults=function(){"use strict";function t(t){return this.options=_.extend(this.defaults(),t),this.EMBED_KEY=this.options.key||"",this.limit=this.options.limit||5,this._validateEmbedKey()?void 0:void(this.blocked=!0)}function e(t){window.console&&window.console.error(t)}function i(t,e){if("js"==e){var i=document.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",t)}else if("css"==e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t)}"undefined"!=typeof i&&document.getElementsByTagName("head")[0].appendChild(i)}function n(){return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 668.487 99.661" style="enable-background:new 0 0 668.487 99.661;" xml:space="preserve"><g id="Calque_1"><path d="M178.48,0.416h-34.814h-0.009c-27.361,0-49.541,22.182-49.541,49.543c0,27.358,22.18,49.54,49.541,49.54   c0,0,0.005,0,0.009,0h34.814c27.358-0.003,49.536-22.181,49.536-49.54C228.017,22.598,205.838,0.419,178.48,0.416z M178.486,78.512   c-0.021,0-0.041,0-0.062,0h-34.72c-0.021,0-0.043,0-0.064,0c-15.775,0-28.564-12.793-28.564-28.563   c0-15.777,12.788-28.57,28.564-28.57c0.005,0,0.007,0,0.008,0v-0.017h34.826v0.017c0.005,0,0.01,0,0.013,0   c15.775,0,28.565,12.793,28.565,28.57C207.052,65.72,194.262,78.512,178.486,78.512z M258.242,40.758h78.573v18.385h-78.57   c3.83,11.265,14.495,19.369,27.053,19.369c0.021,0,0.04,0,0.061,0h53.259l9.95,20.986h-63.246h-0.011   c-27.358,0-49.538-22.181-49.538-49.54c0-27.361,22.18-49.543,49.538-49.543c0.003,0,0.008,0,0.011,0h63.246l-9.943,20.947h-53.318   v0.017c-0.004,0-0.005,0-0.009,0C272.736,21.379,262.068,29.491,258.242,40.758z M542.806,40.758h78.565v18.385h-78.565   c3.829,11.265,14.492,19.369,27.051,19.369c0.02,0,0.043,0,0.066,0h53.257l9.943,20.986h-63.24h-0.013   c-27.356,0-49.537-22.181-49.537-49.54c0-27.361,22.182-49.543,49.537-49.543c0,0,0.006,0,0.013,0h63.24l-9.936,20.947h-53.323   v0.017c-0.003,0-0.003,0-0.007,0C557.295,21.379,546.628,29.491,542.806,40.758z M668.487,0.416v14.206l-20.986,6.738V0.416   H668.487z M647.501,28.408l20.986-6.734v77.819h-20.986V28.408z M493.101,16.044l25.195,83.587H497.34l-18.02-59.405l-6.438-21.221   l-6.417,21.155l-14.665,48.342l-0.759,2.499c-1.975,4.819-6.577,8.293-12.023,8.63c-0.291,0.02-0.581,0.029-0.879,0.029   c-0.29,0-0.587-0.01-0.878-0.029c-5.579-0.347-10.273-3.979-12.165-8.986l-0.542-1.78l-14.774-48.714l-6.414-21.145l-6.444,21.234   l-18.016,59.392H357.95l25.084-83.227l1.047-3.453c2.77-6.913,9.174-11.974,16.85-12.823h4.579   c7.817,0.865,14.321,6.104,16.995,13.219l0.951,3.367l14.72,52.244l14.49-51.706c0,0,0.699-2.938,1.222-4.364   c2.786-6.88,9.171-11.914,16.823-12.76C471.46,0.043,472.229,0,472.999,0c0.775,0,1.541,0.043,2.291,0.128   c7.801,0.862,14.288,6.078,16.982,13.166L493.101,16.044z M0,0.413h21.02v98.894H0V0.413z M57.215,59.11l49.895,40.184H77.155   L32.777,63.551l-1.018-0.819c-3.58-3.12-5.843-7.712-5.843-12.829c0-5.034,2.187-9.557,5.662-12.67l1.385-1.116L77.131,0.508   h29.955L57.224,40.706l-11.409,9.197L57.215,59.11z" /></g></svg>'}function s(t){var e=parseInt(t,10),i=Math.floor(e/3600),n=Math.floor((e-3600*i)/60),s=e-3600*i-60*n;10>i&&(i="0"+i),10>n&&(n="0"+n),10>s&&(s="0"+s),i=i>0?i+":":"";var r=i+n+":"+s;return r}function r(t,e,i){if(!t)return"";if(!i||!e)return t;var n,s=!0;if(t.indexOf("#")>0){var r=t.indexOf("#");n=t.substring(t.indexOf("#"),t.length)}else n="",r=t.length;var o=t.substring(0,r),l=o.split("?"),c="";if(l.length>1)for(var u=l[1].split("&"),a=0;a<u.length;a++){var h=u[a].split("=");s&&h[0]==e||(""==c?c="?":c+="&",c+=h[0]+"="+(h[1]?h[1]:""))}return""==c&&(c="?"),""!==c&&"?"!=c&&(c+="&"),c+=e+"="+(i?i:""),l[0]+c+n}return _.mixin(t.prototype,{defaults:function(){var t=this;return{domain:"https://koemei.com",searchAPI:"/api/search/files",prefetchAPI:"/api/files",width:"500px",prefetch:!0,showTranscript:!0,target:"self",openOnSelect:!1,limit:5,mode:"onType",minLength:1,templates:{searching:"Searching ...",noResults:"No results found. Try another query.",suggestion:function(e){return t._getSuggestionTemplate(e)}},css:"http://iplusstd.com/koemei/search-results-plugin/dist/style.min.css",fontcss:"https://koemei.com/css/font.css"}},_validateEmbedKey:function(){return this.EMBED_KEY&&""!==this.EMBED_KEY?!0:(e("Koemei's Embed Key is required"),!1)},_addCSS:function(){this.options.css&&i(this.options.css,"css"),this.options.fontcss&&i(this.options.fontcss,"css")},_linkElements:function(t,i){if(!t)return e("first parameter must be an input field.");if(!i)return e("second parameter must be a dom element.");this.input=new KomeiInput(t,this.options),this.linkedEl=i,this.linkedEl.innerHTML="";var n=document.createElement("div");n.className="k-results",this.linkedEl.appendChild(n),this.resultsDom=n},_setWidth:function(){this.options.width&&(this.linkedEl.style.width=this.options.width)},_initialize:function(t,e){this.blocked||(this._linkElements(t,e),this._addCSS(),this.clear(),this._setWidth(),this._initEngine(),this._resetSuggestionElement(),this._start())},_start:function(){var t=this;t.input&&(this.input.el.addEventListener("queryChanged",function(e){t.update(e.detail)}),this.input.initialize())},_initEngine:function(){var t=this,i=t.EMBED_KEY,n={initialize:!1,datumTokenizer:function(t){return Bloodhound.tokenizers.whitespace(t._id)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:t.options.domain+t.options.searchAPI,dataType:"jsonp",transform:function(t){return t.results},replace:function(t,e){return t+"?token="+i+"&transcripts=true&q="+e}},identify:function(t){return t._id}};t.options.prefetch&&(n.prefetch={url:t.options.domain+t.options.prefetchAPI+"?token="+i,dataType:"jsonp"}),t.engine=new Bloodhound(n),t.engine.initialize().fail(function(){e("[Bloodhound error]")})},_overwrite:function(t,e){e=e||[],e.length?this._renderSuggestions(t,e):this.options.templates.searching?this._renderSearching(t):this._empty()},_append:function(t,e){e=e||[],e.length&&this.suggestionEl?this._appendSuggestions(t,e):e.length?this._renderSuggestions(t,e):!this.suggestionEl&&this.options.templates.noResults&&this._renderNoResults(t)},_renderSuggestions:function(t,e){var i=document.createElement("div");i.className="k-suggestions",i.innerHTML="",this.resultsDom.innerHTML="",this.resultsDom.appendChild(i),this.resultsDom.appendChild(this._getFooter(t,e)),this.suggestionEl=i,this._appendSuggestions(t,e)},_appendSuggestions:function(t,e){for(var i=this,n=0;n<e.length;n++)i.suggestionEl.appendChild(i._getSuggestionElement(e[n]))},_resetSuggestionElement:function(){this.suggestionEl=null,delete this.suggestionEl},_renderSearching:function(t){this._resetSuggestionElement(),this.resultsDom.innerHTML='<div class="k-searching">'+this.options.templates.searching+"</div>"},_renderNoResults:function(t){this._resetSuggestionElement(),this.resultsDom.innerHTML='<div class="k-no-results">'+this.options.templates.noResults+"</div>"},_empty:function(){this._resetSuggestionElement(),this.resultsDom.innerHTML=""},_getFooter:function(t,e){var i=document.createElement("div");return i.className="k-results-footer",i.innerHTML='powered by <a href="//koemei.com" target="_blank"><icon>'+n()+"</icon></a>",i},_getSuggestionElement:function(t){var e=document.createElement("div");return e.className="k-suggestion",e.innerHTML=this.options.templates.suggestion(t),e},_getSuggestionTemplate:function(t){var e=this,i=t.pictureUrl||"http://d3m8q0cwynqlq3.cloudfront.net/images/koemei-media-thumb.jpg",n=t.created.substring(0,10),o="",l=s(t.length),c=e.options.openOnSelect?"openOnSelect":"",o='<div class="'+c+'"><div class="wrapper-item"><div class="wrapper-info"><a class="img-item koemei-pullLeft" href="'+t.srcUrl+'"><div class="gradient"></div><img src="'+i+'" alt=""><div class="time-item">'+l+'</div></a><a href="'+t.srcUrl+'"><div class="wrapper-title"><div class="title-item">'+t.name+'</div><div class="date-item">'+n+" Â· by "+t.creator.displayName+"</div></div></a> </div></div>";if(e.options.showTranscript&&t.matchingTranscripts&&t.matchingTranscripts.list){o+='<ul class="MediaListItem-segments active">';for(var u,a,h=0;2>h&&h<t.matchingTranscripts.list.length;h++)u=t.matchingTranscripts.list[h],a=u.start/100,o+='<li><a href="'+r(t.srcUrl,"time",a)+'"><span class="koemei-blue time">'+s(a)+'</span> <div class="MediaListItem-segment">'+u.highlight+"</div></a></li>";o+="</ul>"}return o+="</div>"},initialize:function(t,e){return this._initialize(t,e)},update:function(t){function e(e){r||(r=!0,e=(e||[]).slice(0,n.limit),o=e.length,n._overwrite(t,e))}function i(e){e=e||[],!s&&o<n.limit&&(n.cancel=function(){},o+=e.length,n._append(t,e.slice(0,n.limit-o)))}var n=this,s=!1,r=!1,o=0;this.cancel(),this.cancel=function(){s=!0,n.cancel=function(){}},n.engine.search(t,e,i),!r&&e([])},cancel:function(){},clear:function(){this._empty(),this.cancel()}}),t}();